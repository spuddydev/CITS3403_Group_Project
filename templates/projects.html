{% extends 'base.html' %}

{% block title %}Projects - ResearchMatch{% endblock %}

{% block content %}
<div class="content-container">
    <div class="page-header" style="margin-bottom: 25px;">
        <h1>Research Projects</h1>
        <p class="text-muted">Browse all available research projects</p>
    </div>

    <div class="filters-container" style="margin-bottom: 30px;">
        <div class="filter-group">
            <label for="filter-faculty">Faculty:</label>
            <select id="filter-faculty" class="form-control">
                <option value="">All Faculties</option>
                <option value="science">Science</option>
                <option value="engineering">Engineering</option>
                <option value="medicine">Medicine</option>
                <option value="arts">Arts</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label for="filter-status">Status:</label>
            <select id="filter-status" class="form-control">
                <option value="">All</option>
                <option value="open">Open</option>
                <option value="closed">Closed</option>
            </select>
        </div>
        
        <button id="apply-filters" class="btn">Apply Filters</button>
    </div>

    <div class="projects-container">
        {% for project in projects %}
        <div class="project-card {% if project.is_open %}open-project{% else %}closed-project{% endif %}" 
             data-faculty="{% for area in project.research_areas %}{{ area.area|lower }}{% if not loop.last %} {% endif %}{% endfor %}" 
             style="margin-bottom: 25px;">
             
            <div class="project-header" style="margin-bottom: 15px;">
                <div class="project-category">
                    {% for interest in project.interests %}
                    <span class="category-badge">{{ interest.interest_name }}</span>
                    {% endfor %}
                </div>
                <div class="project-status">
                    <span class="status-badge {% if project.is_open %}open{% else %}closed{% endif %}">
                        {{ 'Open' if project.is_open else 'Closed' }}
                    </span>
                </div>
            </div>
            
            <h3 class="project-title" style="margin-bottom: 12px;">{{ project.title }}</h3>
            
            <div class="project-meta" style="margin-bottom: 12px;">
                <div class="meta-item">
                    <span class="meta-label">Researcher:</span>
                    <span class="meta-value">
                        {% for researcher in project.researchers %}
                            {{ researcher.first_name }} {{ researcher.last_name }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </span>
                </div>
                
                <div class="meta-item">
                    <span class="meta-label">Faculty:</span>
                    <span class="meta-value">
                        {% for area in project.research_areas %}
                            {{ area.area }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </span>
                </div>
                
                {% if project.is_open and project.close_date %}
                <div class="meta-item">
                    <span class="meta-label">Close Date:</span>
                    <span class="meta-value">{{ project.close_date.strftime('%d %b %Y') }}</span>
                </div>
                {% endif %}
                
                {% if not project.is_open and project.publication_date %}
                <div class="meta-item">
                    <span class="meta-label">Published:</span>
                    <span class="meta-value">{{ project.publication_date.strftime('%d %b %Y') }}</span>
                </div>
                {% endif %}
            </div>
            
            {% if project.summary %}
            <div class="project-summary" style="margin-bottom: 20px;">
                <p>{{ project.summary|truncate(200) }}</p>
            </div>
            {% endif %}
            
            <div class="project-actions">
                <a href="{{ project.link }}" target="_blank" class="btn primary">View Details</a>
                <button class="btn secondary save-project" data-project-id="{{ project.id }}">
                    <i class="fas fa-bookmark"></i> Save
                </button>
            </div>
        </div>
        {% else %}
        <div class="no-data-message">
            <p>No projects found. Please check back later.</p>
        </div>
        {% endfor %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const facultyFilter = document.getElementById('filter-faculty');
    const statusFilter = document.getElementById('filter-status');
    const applyButton = document.getElementById('apply-filters');
    const projects = document.querySelectorAll('.project-card');

    applyButton.addEventListener('click', function() {
        const selectedFaculty = facultyFilter.value.toLowerCase();
        const selectedStatus = statusFilter.value.toLowerCase();

        projects.forEach(project => {
            const faculty = project.getAttribute('data-faculty');
            const isOpen = project.classList.contains('open-project');
            const isClosed = project.classList.contains('closed-project');

            const matchesFaculty = !selectedFaculty || faculty.includes(selectedFaculty);
            const matchesStatus = !selectedStatus ||
                (selectedStatus === 'open' && isOpen) ||
                (selectedStatus === 'closed' && isClosed);

            project.style.display = (matchesFaculty && matchesStatus) ? '' : 'none';
        });
    });
});
</script>
{% endblock %}
